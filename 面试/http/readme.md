# http1

当年的传输的文件比较小

当一个 html 文件中有引入其它文件比如 js 文件,图片文件之类,每一个资源的引入需要建立连接传输,传输完毕断开连接 tcp 连接,尽管文件都是在同一台服务器上,每次建立连接都需要三次请求

页面当中的资源文件变大,页面当中的引用变多,就会导致建立连接变多,连接变多,就会导致网络传输变慢

# http1.1

- 特点:
  持久连接
  一个 tcp 连接可以传输多个 http 请求,减少了大量 tcp 连接和断开连接的开销

浏览器默认支持 6 个 tcp 持久连接
请求头当中的字段
也可以关闭 Connection: close 默认是开启的

- 缺点:
  但是持久连接也带来问题在 http1.1 解决不了
  然后 http 请求就在排队,然后就会存在阻塞,队头阻塞,前面的 http 没有响应的话后面的 http 请求是无法发送的

- 新增的技术:

1. 管线化思路:批量发送请求,一次性发送全部的 http 请求(放弃)
2. 虚拟机:host 字段,用来具体区分访问那个网站
3. 动态内容 content-length,但是在长度不是固定的,那么如何确定长度呢?
   Chunk transfer 机制: 处理返回动态数据的长度表示问题,将数据分隔成若干个任意大小的数据块,每个数据块标记好长度最后发送一个长度为 0 的数据块来标志数据传输结束
4. cookies
   在服务端设置 httpOnly 的 cookie

# http2

- 1.1 的问题,带宽用不满

1. tcp 的慢启动:拥塞控制导致一定会慢启动,慢启动导致页面关键的资源加载时间推后
2. 多条 tcp 连接竞争带宽会导致每条 tcp 连接中能被分配的带宽大大降低
3. 队头阻塞,前面的请求延迟,后面一个请求便无法发送,带宽地址浪费

同时维护多个 tcp 连接会竞争导致带宽减少,导致关键资源的加载时间变慢
tcp 具有一个慢启动阶段,先会感知网络的情况,推迟首次渲染页面的时间

如果只开 1 个 tcp 连接的话 消耗的时间 100*n*RTT,开 6 个 tcp 连接的话 消耗的时间 100*n*RTT/6

http1.1 很难将带宽充分利用,http2 可以利用多路复用技术,将多个 http 请求合并在一个 tcp 连接上发送,减少 tcp 连接的开销,提高网络传输效率

- 2.0 多路复用
1. 解决带宽问题:
一个域名只使用一个 tcp 连接 ,解决带宽浪费问题
2. 解决队头拥塞:
将每一个请求分成一帧一帧的数据进行传输并打上标记,同时发送给服务端,且可以在重要资源中编辑为加急,服务端收到带有各种编号的数据后,可以区分哪个数据帧加急,优先整理和响应该请求的数据帧(通过引入二进制分帧层实现多路复用)

将请求体碎片化,让后对请求体的一些碎片打上标记,标记哪些是重要的


# http3


